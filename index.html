<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSG Multiservice - Admin Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="icon" type="image/png" href="splash_logo.png">
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        .loader { border-top-color: #c53030; -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans">

    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gray-900 p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-sm">
            <div class="flex justify-center mb-6"><img src="splash_logo.png" alt="Logo" class="h-20"></div>
            <h2 class="text-2xl font-bold text-center text-white mb-2">Admin Panel Login</h2>
            <p class="text-center text-gray-400 mb-6">RSG Multiservice SRLS</p>
            <form id="login-form">
                <div class="mb-4">
                    <label for="email" class="block text-gray-400 mb-2">Email</label>
                    <input type="email" id="email" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-gray-400 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" required>
                </div>
                <button type="submit" id="login-button" class="w-full bg-red-700 hover:bg-red-800 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Login
                </button>
            </form>
            <p id="login-error" class="text-red-500 text-center mt-4"></p>
        </div>
    </div>

    <div id="login-spinner-template" class="hidden">
        <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 mx-auto"></div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAxyGsVS9cuuv2bkwWKcj3ZgQPzIA5T15w",
            authDomain: "plats-83345.firebaseapp.com",
            projectId: "plats-83345",
            storageBucket: "plats-83345.appspot.com",
            messagingSenderId: "619656775053",
            appId: "1:619656775053:web:25249b178c03afba52e9c4",
            measurementId: "G-WKPK539FW6"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM Elements
        const loginForm = document.getElementById('login-form');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginButton = document.getElementById('login-button');
        const loginError = document.getElementById('login-error');
        const spinnerTemplate = document.getElementById('login-spinner-template');

        // Login Form Submit Logic
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = emailInput.value;
            const password = passwordInput.value;
            
            // Show loading spinner
            const originalButtonText = loginButton.innerHTML;
            loginButton.innerHTML = spinnerTemplate.innerHTML;
            loginButton.disabled = true;
            loginError.textContent = '';

            try {
                // 1. Sign in the user
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // 2. Check if user is an ADMIN
                const userDocRef = doc(db, "users", user.uid);
                const userDocSnap = await getDoc(userDocRef);

                if (userDocSnap.exists() && userDocSnap.data().role === 'ADMIN') {
                    // 3. Success! Redirect to dashboard.html
                    window.location.href = 'dashboard.html';
                } else {
                    // Not an admin or no database record
                    throw new Error('Access Denied. Only admins can log in here.');
                }
            } catch (error) {
                // Handle errors
                let friendlyMessage = 'An unknown error occurred.';
                switch (error.code) {
                    case 'auth/user-not-found':
                    case 'auth/wrong-password':
                    case 'auth/invalid-credential':
                        friendlyMessage = 'Invalid email or password.';
                        break;
                    case 'auth/too-many-requests':
                        friendlyMessage = 'Too many attempts. Please try again later.';
                        break;
                }
                // Show custom error if it was our 'Access Denied' error
                if (error.message.includes('Access Denied')) {
                    friendlyMessage = error.message;
                }
                
                loginError.textContent = friendlyMessage;
                // Restore button
                loginButton.innerHTML = originalButtonText;
                loginButton.disabled = false;
            }
        });
    </script>
</body>
</html>